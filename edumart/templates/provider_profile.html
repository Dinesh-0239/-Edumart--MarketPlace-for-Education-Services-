{% extends "home_base.html" %}
{% load static %}

{% block title %}{{ provider.username }}'s Profile | EduMart{% endblock %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/profile_style.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-5 pt-5">
    <div class="main-content">

        <!-- Provider Profile Section -->
        <div class="profile-section service-provider">
            <img src="{{ provider.profile_picture.url }}" alt="Provider Profile Image" class="profile-large">
            <div class="profile-info">
                <span class="service-provider-badge">Service Provider</span>
                <h3>{{ provider.username }}</h3>
                <p class="text-muted"><strong>Email:</strong> {{ provider.email }}</p>
                <p><strong>Bio:</strong> {{ provider.bio }}</p>
            </div>
        </div>

        <!-- Provider's Services Section -->
        <div class="services-section">
            <h4>{{ provider.username }}'s Services</h4>
            <div class="service-list">
                {% for service in services %}
                    <div class="service-card">
                        {% if service.image %}
                            <img src="{{ service.image.url }}" alt="{{ service.title }}">
                        {% else %}
                            <img src="{% static 'images/default-service.jpg' %}" alt="Default Service">
                        {% endif %}
                        <h5>{{ service.title }}</h5>
                        <p><strong>Category:</strong> {{ service.category }}</p>
                        <p><strong>Price:</strong> ₹{{ service.price }}</p>
                        <p><strong>Availability:</strong> 
                            {% if service.available %} ✅  {% else %} ❌  {% endif %}
                        </p>
                        <p><strong>Created on:</strong> {{ service.created_at|date:"M d, Y" }}</p>
                        <p class="service-desc"><strong>Description: </strong>{{ service.description }}</p>
                        <div class="service-actions">
                        {% if request.user.is_authenticated and not request.user.is_service_provider %}
                            <a href="{% url 'create_booking' service.id %}" class="btn btn-success">Book Service</a>
                        {% endif %}
                            <a href="{% url 'view_service_reviews' service.id %}" class="btn btn-info">View Reviews</a>
                        </div>
                    </div>
                {% empty %}
                    <p class="text-muted">{{ provider.username }} hasn't listed any services yet.</p>
                {% endfor %}
            </div>
        </div>

        <!-- Reviews & Ratings Section -->
        <div class="reviews-section">
            <h4>Reviews for {{ provider.username }}'s Services</h4>
            <div class="review-list">
                {% if provider_reviews %}
                    {% for review in provider_reviews %}
                        <div class="review-card">
                            <p><strong>Service:</strong> {{ review.service.title }}</p>
                            <p><strong>Provider:</strong> {{ review.service.provider.username }}</p> 
                            <p><strong>Reviewer:</strong> {{ review.client.username }}</p> 

                            <!-- ⭐ Star Rating Display -->
                            <p><strong>Rating:</strong> 
                                <span class="stars">
                                    {% for i in "12345"|make_list %}
                                        {% if forloop.counter <= review.rating %}
                                            <span class="star filled">★</span>
                                        {% else %}
                                            <span class="star">☆</span>
                                        {% endif %}
                                    {% endfor %}
                                </span> ({{ review.rating }}/5)
                            </p>

                            <p class="review-comment"><strong>Comment:</strong> {{ review.comment }}</p>

                            <!-- ✅ Date & Time Display -->
                            <p class="review-date text-muted">
                                <strong>Reviewed on:</strong> {{ review.created_at|date:"M d, Y" }} at {{ review.created_at|time:"h:i A" }}
                            </p>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">No reviews yet.</p>
                {% endif %}
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block script %}
<script src="{% static 'js/profile_script.js' %}" defer></script>
{% endblock %}
